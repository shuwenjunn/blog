# CRM 微前端调研&评估

## 现状分析

1. 项目的基础依赖关系 webpack 分析

## 微前端可以解决哪些痛点

1. 可以独立部署，分模块上线
2. 职责清晰，顺便解决目前项目依赖乱的
3. 丢掉一些历史包袱,重构现有的框架，解决一些代码紊乱的问题。例如未知的样式

## 实施过程中所遇到的问题

1. 代码的依赖过于混乱
2. 组件依赖过于混乱
3. 样式依赖过于混乱
4. 路由跳转拦截
5. Ren-debug 改造
6. 最好不改变现有的路径
7. 构建开发环境，多个应用
8. 权限
9. 主应用共享组件
10. 国际化，分发
11. 考虑部署问题
12. 开发环境性能问题
13. 路径问题
14. 处理公共模版
15. 公共样式类注入多个项目
16. 同时展示多个子应用
17. 微应用的根据业务进行拆分后，路由可能会有所改变

## 缺点

1. 会不会限制业务发展

## 改造思路

1. 基座包含基础内容，
   1. 项目的共同依赖组件以及业务逻辑，主要包含 `common`文件夹，`common-module`文件夹
   2. 初始化初始化逻辑 涉及到 mainang
2. 小模块试水，测试稳定性
3. 系统稳定后拆分大模块

## 可选框架

- Qiankun 基于 single-SPA
- webComponent+html entry
- Qiankun 大部分子应用都是通过路由激活的，能不能有多个入口同时进行激活，和服务端的微服务高度相似
- qiankun 子应用保活

## 方案选型

### qiankun（最大问题无法同时激活多个子应用）

> 原理：Single-spa 的实现原理是通过将应用程序拆分成小块，并通过路由匹配和动态加载技术来实现微前端架构的。

1. 单个版本内完成，渐进式改造
2. 某些样式需要共用。
3. 多应用保活
4. Qiankun。single spa 单 html 入口
5. CRM 某些业务的相关性比较强，某些地方可能并不需要完全隔离
6. 类似服务端的业务耦合方向拆分微应用，需要满足一个微应用多个出口，多个微应用同时激活的特点
7. **qiankun 无法做到多个子应用同时激活，无法完全解耦。**

### wujie

1. 基于 web component 兼容性。https://www.webcomponents.org/?mode=light
2. 熟悉原理
3. 主应用的调用方式，例如 chat 模块，chat 子应用可以被单独加载

### 实施

1. 元组件拆分例如，common-module 中的组件，common 文件夹中的组件，crm-package 组件
2. 路由改造,header 改造
3. 应用初始化改造，infodata 改造

4. 查看依赖关系
5. 公共样式公共类提取
6. 开发调试问题
7. 输出一种快速迁移的模式，方便大家可以快速的将业务模块尽快迁移
